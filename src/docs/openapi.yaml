openapi: 3.1.0
info:
  title: TriviAndo API
  version: 1.0.0
  description: >
    API del proyecto **TrivIAndo**, desarrollada para la materia *Arquitectura de Software (ARSW)*.  
    Permite registro de usuarios, autenticaci칩n segura y generaci칩n autom치tica de trivias mediante IA.
  contact:
    name: Pokesaurios
    email: pokesaurios@triviando.com
servers:
  - url: http://localhost:4000/api
    description: Servidor local de desarrollo

tags:
  - name: Autenticaci칩n
    description: Endpoints de registro e inicio de sesi칩n
  - name: Trivias
    description: Generaci칩n y gesti칩n de trivias con IA

paths:
  /auth/register:
    post:
      tags:
        - Autenticaci칩n
      summary: Registro de usuario
      description: Registra un nuevo jugador en el sistema.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nombre:
                  type: string
                  example: Juan P칠rez
                correo:
                  type: string
                  example: juanperez@email.com
                contrase침a:
                  type: string
                  example: Password123!
      responses:
        "201":
          description: Usuario registrado correctamente.
        "400":
          description: Correo ya registrado o datos inv치lidos.

  /auth/login:
    post:
      tags:
        - Autenticaci칩n
      summary: Inicio de sesi칩n
      description: Inicia sesi칩n con correo y contrase침a v치lidos.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                correo:
                  type: string
                  example: juanperez@email.com
                contrase침a:
                  type: string
                  example: Password123!
      responses:
        "200":
          description: Sesi칩n iniciada correctamente.
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        "401":
          description: Credenciales incorrectas.

  /trivia/generate:
    post:
      summary: Generar trivia autom치tica con IA
      description: Genera una trivia basada en un tema usando inteligencia artificial (Gemini).
      tags:
        - Trivia
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - topic
                - quantity
              properties:
                topic:
                  type: string
                  example: "Historia de Colombia"
                quantity:
                  type: integer
                  minimum: 3
                  maximum: 15
                  example: 6
      responses:
        "201":
          description: Trivia generada exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Trivia generada exitosamente 游꿀
                  triviaId:
                    type: string
                    example: 671e8a12c49dba0012d87aa4
                  totalQuestions:
                    type: integer
                    example: 6
                  preview:
                    type: array
                    items:
                      type: object
                      properties:
                        question:
                          type: string
                          example: "쯈ui칠n fue el libertador de Colombia?"
                        options:
                          type: array
                          items:
                            type: string
                          example: ["Sim칩n Bol칤var", "Francisco de Paula Santander", "Antonio Nari침o", "Jos칠 Mar칤a C칩rdoba"]
                        correctAnswer:
                          type: string
                          example: "Sim칩n Bol칤var"
                        difficulty:
                          type: string
                          example: "easy"
        "400":
          description: Error de validaci칩n (tema o cantidad inv치lida)
        "500":
          description: Error interno o fallo de IA
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Trivia:
      type: object
      properties:
        tema:
          type: string
          example: Historia de Colombia
        idioma:
          type: string
          example: es
        preguntas:
          type: array
          items:
            type: object
            properties:
              enunciado:
                type: string
                example: 쯈ui칠n fue el libertador de Colombia?
              opciones:
                type: array
                items:
                  type: string
                example:
                  - Sim칩n Bol칤var
                  - Santander
                  - Nari침o
                  - Sucre
              respuestaCorrecta:
                type: string
                example: Sim칩n Bol칤var
              dificultad:
                type: string
                enum: [f치cil, media, dif칤cil]
                example: f치cil
              explicacion:
                type: string
                example: Bol칤var lider칩 la independencia de Colombia en 1819.
  /rooms:
    post:
      summary: Crear una nueva sala
      description: Crea una sala multijugador asociada a una trivia y devuelve su c칩digo 칰nico.
      tags:
        - Salas
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                topic:
                  type: string
                  example: "Cultura general"
                triviaId:
                  type: string
                  example: 671e8a12c49dba0012d87aa4
                maxPlayers:
                  type: integer
                  example: 4
      responses:
        "201":
          description: Sala creada exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Room created successfully
                  roomId:
                    type: string
                    example: 671f29b6b95dbe0014e9e103
                  code:
                    type: string
                    example: X4BZ7Q
                  topic:
                    type: string
                    example: Cultura general
                  maxPlayers:
                    type: integer
                    example: 4
        "401":
          description: Usuario no autenticado
        "500":
          description: Error al crear la sala

  /rooms/join:
    post:
      summary: Unirse a una sala existente
      description: Permite a un usuario autenticado unirse a una sala ingresando su c칩digo.
      tags:
        - Salas
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - code
              properties:
                code:
                  type: string
                  example: X4BZ7Q
      responses:
        "200":
          description: Uni칩n exitosa a la sala
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Joined room successfully
                  room:
                    $ref: "#/components/schemas/Room"
        "404":
          description: Sala no encontrada o llena
        "400":
          description: El usuario ya est치 en la sala

  /rooms/{code}:
    get:
      summary: Obtener informaci칩n de una sala
      description: Devuelve los detalles de una sala por su c칩digo, incluyendo jugadores conectados.
      tags:
        - Salas
      security:
        - bearerAuth: []
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
            example: X4BZ7Q
      responses:
        "200":
          description: Informaci칩n de la sala
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Room"
        "404":
          description: Sala no encontrada

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Room:
      type: object
      properties:
        _id:
          type: string
          example: 671f29b6b95dbe0014e9e103
        code:
          type: string
          example: X4BZ7Q
        hostId:
          type: string
          example: 671f2939b95dbe0014e9e0ff
        topic:
          type: string
          example: Cultura general
        triviaId:
          type: string
          example: 671e8a12c49dba0012d87aa4
        status:
          type: string
          enum: [waiting, in-game, finished]
          example: waiting
        maxPlayers:
          type: integer
          example: 4
        players:
          type: array
          items:
            type: object
            properties:
              userId:
                type: string
                example: 671f2939b95dbe0014e9e0ff
              name:
                type: string
                example: Juan P칠rez
              socketId:
                type: string
                example: "u2asx3sUOp83"
              joinedAt:
                type: string
                format: date-time
                example: "2025-10-21T02:31:21.000Z"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
